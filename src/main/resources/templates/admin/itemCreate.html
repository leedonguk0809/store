<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상품 추가</title>
    <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="/css/admin-modal.css" />
</head>
<body>
<div class="container">
    <h1>상품 추가</h1>
    <button
            id="addProductBtn"
            type="button"
            class="btn btn-primary btn-dark btn-sm float-right mb-3"
    >
        신규 상품 추가
    </button>

    <!-- 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="form-group">
                <label for="productName">상품 이름</label>
                <input
                        type="text"
                        class="form-control"
                        id="productName"
                        name="productName"
                        required
                />
            </div>
            <div class="form-group">
                <label for="productPrice">상품 가격</label>
                <input
                        type="number"
                        class="form-control"
                        id="productPrice"
                        name="productPrice"
                        required
                />
            </div>
            <div class="form-group">
                <label for="stockQuantity">재고량</label>
                <input
                        type="number"
                        class="form-control"
                        id="stockQuantity"
                        name="stockQuantity"
                        required
                />
            </div>
            <div class="form-group">
                <label for="productDescription">상품 상세 정보</label>
                <textarea
                        class="form-control"
                        id="productDescription"
                        name="productDescription"
                        rows="3"
                        required
                ></textarea>
            </div>
            <div class="form-group">
                <label for="productImage">이미지 업로드</label>
                <input
                        type="file"
                        class="form-control-file"
                        id="productImage"
                        name="productImage"
                        accept="image/*"
                        required
                />
            </div>
            <button type="button" class="btn btn-primary" onclick="createItem()">
                저장
            </button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // 모달 열기
    document
        .getElementById("addProductBtn")
        .addEventListener("click", function () {
            document.getElementById("productModal").style.display = "block";
        });

    // 모달 닫기
    document
        .getElementsByClassName("close")[0]
        .addEventListener("click", function () {
            document.getElementById("productModal").style.display = "none";
        });

    // 모달 외부 클릭 시 닫기
    window.addEventListener("click", function (event) {
        if (event.target == document.getElementById("productModal")) {
            document.getElementById("productModal").style.display = "none";
        }
    });

    // 폼 데이터를 JSON으로 변환하여 서버로 전송
    const createItem = () => {
        var productName = document.getElementById("productName").value;
        var productPrice = document.getElementById("productPrice").value;
        var stockQuantity = document.getElementById("stockQuantity").value;
        var productDescription = document.getElementById("productDescription").value;
        var productImage = document.getElementById("productImage").files[0];

        // JSON 데이터 생성
        var data = {
            name: productName,
            price: productPrice,
            quantity: stockQuantity,
            info: productDescription
        };

        // FormData 객체 생성
        var formData = new FormData();
        formData.append('data', JSON.stringify(data)); // JSON 데이터 문자열을 FormData에 추가
        formData.append('productImage', productImage); // 파일 데이터를 FormData에 추가

        // 서버에 POST 요청 보내기
        fetch('/add-product', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // 성공적으로 데이터를 저장한 후 추가적인 작업 수행
                // 예: 모달 닫기 등
                document.getElementById("productModal").style.display = "none";
                // 필요한 추가적인 작업을 여기에 추가할 수 있습니다.
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }
</script>
</body>
</html>
